# @generated by ci-gen, do not edit

on:
    - push
    - pull_request
name: CI
jobs:
    linux-stable-default-features:
        name: linux stable (default features)
        runs-on: ubuntu-latest
        env:
            PROTOBUF_VERSION: 3.6.1
            RUST_BACKTRACE: 1
        steps:
            - name: Checkout sources
              uses: actions/checkout@v2
            - name: Install toolchain
              uses: actions-rs/toolchain@v1
              with:
                  profile: minimal
                  toolchain: stable
                  override: true
            - name: Cache protobuf
              uses: actions/cache@v2
              env:
                  cache-name: pb
              with:
                  key: pb-linux
                  path: ~/pb
            - name: Install protobuf
              run: ci/install-protobuf.sh
              shell: bash
            - name: Protoc check
              run: protoc --version
              shell: bash
            - name: Compile interop
              run: interop/cxx/compile.sh
              shell: bash
            - name: Regenerate
              run: protobuf/regenerate.sh
              shell: bash
            - name: Test all
              run: cargo test --all --all-targets
              shell: bash
            - name: cargo doc
              uses: actions-rs/cargo@v1
              with:
                  command: doc
            - name: test protoc
              run: protoc/test.sh
              shell: bash
    linux-beta-default-features:
        name: linux beta (default features)
        runs-on: ubuntu-latest
        env:
            PROTOBUF_VERSION: 3.6.1
            RUST_BACKTRACE: 1
        steps:
            - name: Checkout sources
              uses: actions/checkout@v2
            - name: Install toolchain
              uses: actions-rs/toolchain@v1
              with:
                  profile: minimal
                  toolchain: beta
                  override: true
            - name: Cache protobuf
              uses: actions/cache@v2
              env:
                  cache-name: pb
              with:
                  key: pb-linux
                  path: ~/pb
            - name: Install protobuf
              run: ci/install-protobuf.sh
              shell: bash
            - name: Protoc check
              run: protoc --version
              shell: bash
            - name: Compile interop
              run: interop/cxx/compile.sh
              shell: bash
            - name: Regenerate
              run: protobuf/regenerate.sh
              shell: bash
            - name: Test all
              run: cargo test --all --all-targets
              shell: bash
            - name: cargo doc
              uses: actions-rs/cargo@v1
              with:
                  command: doc
            - name: test protoc
              run: protoc/test.sh
              shell: bash
    linux-stable-with-serde:
        name: linux stable (with-serde)
        runs-on: ubuntu-latest
        env:
            PROTOBUF_VERSION: 3.6.1
            RUST_BACKTRACE: 1
        steps:
            - name: Checkout sources
              uses: actions/checkout@v2
            - name: Install toolchain
              uses: actions-rs/toolchain@v1
              with:
                  profile: minimal
                  toolchain: stable
                  override: true
            - name: Cache protobuf
              uses: actions/cache@v2
              env:
                  cache-name: pb
              with:
                  key: pb-linux
                  path: ~/pb
            - name: Install protobuf
              run: ci/install-protobuf.sh
              shell: bash
            - name: Protoc check
              run: protoc --version
              shell: bash
            - name: Compile interop
              run: interop/cxx/compile.sh
              shell: bash
            - name: protobuf-test
              uses: actions-rs/cargo@v1
              with:
                  command: test
                  args: --manifest-path=protobuf-test/Cargo.toml --features=with-serde
            - name: protobuf-codegen-pure-test
              uses: actions-rs/cargo@v1
              with:
                  command: test
                  args: --manifest-path=protobuf-codegen-pure-test/Cargo.toml --features=with-serde
            - name: test protoc
              run: protoc/test.sh
              shell: bash
    linux-stable-with-bytes:
        name: linux stable (with-bytes)
        runs-on: ubuntu-latest
        env:
            PROTOBUF_VERSION: 3.6.1
            RUST_BACKTRACE: 1
        steps:
            - name: Checkout sources
              uses: actions/checkout@v2
            - name: Install toolchain
              uses: actions-rs/toolchain@v1
              with:
                  profile: minimal
                  toolchain: stable
                  override: true
            - name: Cache protobuf
              uses: actions/cache@v2
              env:
                  cache-name: pb
              with:
                  key: pb-linux
                  path: ~/pb
            - name: Install protobuf
              run: ci/install-protobuf.sh
              shell: bash
            - name: Protoc check
              run: protoc --version
              shell: bash
            - name: Compile interop
              run: interop/cxx/compile.sh
              shell: bash
            - name: protobuf-test
              uses: actions-rs/cargo@v1
              with:
                  command: test
                  args: --manifest-path=protobuf-test/Cargo.toml --features=with-bytes
            - name: protobuf-codegen-pure-test
              uses: actions-rs/cargo@v1
              with:
                  command: test
                  args: --manifest-path=protobuf-codegen-pure-test/Cargo.toml --features=with-bytes
            - name: test protoc
              run: protoc/test.sh
              shell: bash
    linux-nightly-all-features:
        name: linux nightly (all features)
        runs-on: ubuntu-latest
        env:
            PROTOBUF_VERSION: 3.6.1
            RUST_BACKTRACE: 1
        steps:
            - name: Checkout sources
              uses: actions/checkout@v2
            - name: Install toolchain
              uses: actions-rs/toolchain@v1
              with:
                  profile: minimal
                  toolchain: nightly
                  override: true
            - name: Cache protobuf
              uses: actions/cache@v2
              env:
                  cache-name: pb
              with:
                  key: pb-linux
                  path: ~/pb
            - name: Install protobuf
              run: ci/install-protobuf.sh
              shell: bash
            - name: Protoc check
              run: protoc --version
              shell: bash
            - name: Compile interop
              run: interop/cxx/compile.sh
              shell: bash
            - name: Test all
              run: cargo test --all --all-targets --all-features
              shell: bash
            - name: cargo doc
              uses: actions-rs/cargo@v1
              with:
                  command: doc
                  args: --all-features
            - name: test protoc
              run: protoc/test.sh
              shell: bash
    windows-stable-default-features:
        name: windows stable (default features)
        runs-on: windows-latest
        env:
            PROTOBUF_VERSION: 3.6.1
            RUST_BACKTRACE: 1
            VCPKGRS_DYNAMIC: 1
        steps:
            - name: Checkout sources
              uses: actions/checkout@v2
            - name: Install toolchain
              uses: actions-rs/toolchain@v1
              with:
                  profile: minimal
                  toolchain: stable
                  override: true
            - name: Cache protobuf
              uses: actions/cache@v2
              env:
                  cache-name: pb
              with:
                  key: pb-windows-1
                  path: ~/pb
            - name: Install protobuf
              run: ci/install-protobuf.sh
              shell: bash
            - name: Protoc check
              run: protoc --version
              shell: bash
